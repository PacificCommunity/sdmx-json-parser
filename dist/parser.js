!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.parser=e():t.parser=e()}(this,(()=>(()=>{"use strict";var t,e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};e.r(s),e.d(s,{SDMXParser:()=>d}),function(t){t[t.BACKSPACE=8]="BACKSPACE",t[t.FORM_FEED=12]="FORM_FEED",t[t.NEWLINE=10]="NEWLINE",t[t.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",t[t.TAB=9]="TAB",t[t.SPACE=32]="SPACE",t[t.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",t[t.QUOTATION_MARK=34]="QUOTATION_MARK",t[t.NUMBER_SIGN=35]="NUMBER_SIGN",t[t.DOLLAR_SIGN=36]="DOLLAR_SIGN",t[t.PERCENT_SIGN=37]="PERCENT_SIGN",t[t.AMPERSAND=38]="AMPERSAND",t[t.APOSTROPHE=39]="APOSTROPHE",t[t.LEFT_PARENTHESIS=40]="LEFT_PARENTHESIS",t[t.RIGHT_PARENTHESIS=41]="RIGHT_PARENTHESIS",t[t.ASTERISK=42]="ASTERISK",t[t.PLUS_SIGN=43]="PLUS_SIGN",t[t.COMMA=44]="COMMA",t[t.HYPHEN_MINUS=45]="HYPHEN_MINUS",t[t.FULL_STOP=46]="FULL_STOP",t[t.SOLIDUS=47]="SOLIDUS",t[t.DIGIT_ZERO=48]="DIGIT_ZERO",t[t.DIGIT_ONE=49]="DIGIT_ONE",t[t.DIGIT_TWO=50]="DIGIT_TWO",t[t.DIGIT_THREE=51]="DIGIT_THREE",t[t.DIGIT_FOUR=52]="DIGIT_FOUR",t[t.DIGIT_FIVE=53]="DIGIT_FIVE",t[t.DIGIT_SIX=54]="DIGIT_SIX",t[t.DIGIT_SEVEN=55]="DIGIT_SEVEN",t[t.DIGIT_EIGHT=56]="DIGIT_EIGHT",t[t.DIGIT_NINE=57]="DIGIT_NINE",t[t.COLON=58]="COLON",t[t.SEMICOLON=59]="SEMICOLON",t[t.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",t[t.EQUALS_SIGN=61]="EQUALS_SIGN",t[t.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",t[t.QUESTION_MARK=63]="QUESTION_MARK",t[t.COMMERCIAL_AT=64]="COMMERCIAL_AT",t[t.LATIN_CAPITAL_LETTER_A=65]="LATIN_CAPITAL_LETTER_A",t[t.LATIN_CAPITAL_LETTER_B=66]="LATIN_CAPITAL_LETTER_B",t[t.LATIN_CAPITAL_LETTER_C=67]="LATIN_CAPITAL_LETTER_C",t[t.LATIN_CAPITAL_LETTER_D=68]="LATIN_CAPITAL_LETTER_D",t[t.LATIN_CAPITAL_LETTER_E=69]="LATIN_CAPITAL_LETTER_E",t[t.LATIN_CAPITAL_LETTER_F=70]="LATIN_CAPITAL_LETTER_F",t[t.LATIN_CAPITAL_LETTER_G=71]="LATIN_CAPITAL_LETTER_G",t[t.LATIN_CAPITAL_LETTER_H=72]="LATIN_CAPITAL_LETTER_H",t[t.LATIN_CAPITAL_LETTER_I=73]="LATIN_CAPITAL_LETTER_I",t[t.LATIN_CAPITAL_LETTER_J=74]="LATIN_CAPITAL_LETTER_J",t[t.LATIN_CAPITAL_LETTER_K=75]="LATIN_CAPITAL_LETTER_K",t[t.LATIN_CAPITAL_LETTER_L=76]="LATIN_CAPITAL_LETTER_L",t[t.LATIN_CAPITAL_LETTER_M=77]="LATIN_CAPITAL_LETTER_M",t[t.LATIN_CAPITAL_LETTER_N=78]="LATIN_CAPITAL_LETTER_N",t[t.LATIN_CAPITAL_LETTER_O=79]="LATIN_CAPITAL_LETTER_O",t[t.LATIN_CAPITAL_LETTER_P=80]="LATIN_CAPITAL_LETTER_P",t[t.LATIN_CAPITAL_LETTER_Q=81]="LATIN_CAPITAL_LETTER_Q",t[t.LATIN_CAPITAL_LETTER_R=82]="LATIN_CAPITAL_LETTER_R",t[t.LATIN_CAPITAL_LETTER_S=83]="LATIN_CAPITAL_LETTER_S",t[t.LATIN_CAPITAL_LETTER_T=84]="LATIN_CAPITAL_LETTER_T",t[t.LATIN_CAPITAL_LETTER_U=85]="LATIN_CAPITAL_LETTER_U",t[t.LATIN_CAPITAL_LETTER_V=86]="LATIN_CAPITAL_LETTER_V",t[t.LATIN_CAPITAL_LETTER_W=87]="LATIN_CAPITAL_LETTER_W",t[t.LATIN_CAPITAL_LETTER_X=88]="LATIN_CAPITAL_LETTER_X",t[t.LATIN_CAPITAL_LETTER_Y=89]="LATIN_CAPITAL_LETTER_Y",t[t.LATIN_CAPITAL_LETTER_Z=90]="LATIN_CAPITAL_LETTER_Z",t[t.LEFT_SQUARE_BRACKET=91]="LEFT_SQUARE_BRACKET",t[t.REVERSE_SOLIDUS=92]="REVERSE_SOLIDUS",t[t.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",t[t.CIRCUMFLEX_ACCENT=94]="CIRCUMFLEX_ACCENT",t[t.LOW_LINE=95]="LOW_LINE",t[t.GRAVE_ACCENT=96]="GRAVE_ACCENT",t[t.LATIN_SMALL_LETTER_A=97]="LATIN_SMALL_LETTER_A",t[t.LATIN_SMALL_LETTER_B=98]="LATIN_SMALL_LETTER_B",t[t.LATIN_SMALL_LETTER_C=99]="LATIN_SMALL_LETTER_C",t[t.LATIN_SMALL_LETTER_D=100]="LATIN_SMALL_LETTER_D",t[t.LATIN_SMALL_LETTER_E=101]="LATIN_SMALL_LETTER_E",t[t.LATIN_SMALL_LETTER_F=102]="LATIN_SMALL_LETTER_F",t[t.LATIN_SMALL_LETTER_G=103]="LATIN_SMALL_LETTER_G",t[t.LATIN_SMALL_LETTER_H=104]="LATIN_SMALL_LETTER_H",t[t.LATIN_SMALL_LETTER_I=105]="LATIN_SMALL_LETTER_I",t[t.LATIN_SMALL_LETTER_J=106]="LATIN_SMALL_LETTER_J",t[t.LATIN_SMALL_LETTER_K=107]="LATIN_SMALL_LETTER_K",t[t.LATIN_SMALL_LETTER_L=108]="LATIN_SMALL_LETTER_L",t[t.LATIN_SMALL_LETTER_M=109]="LATIN_SMALL_LETTER_M",t[t.LATIN_SMALL_LETTER_N=110]="LATIN_SMALL_LETTER_N",t[t.LATIN_SMALL_LETTER_O=111]="LATIN_SMALL_LETTER_O",t[t.LATIN_SMALL_LETTER_P=112]="LATIN_SMALL_LETTER_P",t[t.LATIN_SMALL_LETTER_Q=113]="LATIN_SMALL_LETTER_Q",t[t.LATIN_SMALL_LETTER_R=114]="LATIN_SMALL_LETTER_R",t[t.LATIN_SMALL_LETTER_S=115]="LATIN_SMALL_LETTER_S",t[t.LATIN_SMALL_LETTER_T=116]="LATIN_SMALL_LETTER_T",t[t.LATIN_SMALL_LETTER_U=117]="LATIN_SMALL_LETTER_U",t[t.LATIN_SMALL_LETTER_V=118]="LATIN_SMALL_LETTER_V",t[t.LATIN_SMALL_LETTER_W=119]="LATIN_SMALL_LETTER_W",t[t.LATIN_SMALL_LETTER_X=120]="LATIN_SMALL_LETTER_X",t[t.LATIN_SMALL_LETTER_Y=121]="LATIN_SMALL_LETTER_Y",t[t.LATIN_SMALL_LETTER_Z=122]="LATIN_SMALL_LETTER_Z",t[t.LEFT_CURLY_BRACKET=123]="LEFT_CURLY_BRACKET",t[t.VERTICAL_LINE=124]="VERTICAL_LINE",t[t.RIGHT_CURLY_BRACKET=125]="RIGHT_CURLY_BRACKET",t[t.TILDE=126]="TILDE"}(t||(t={}));const i={[t.QUOTATION_MARK]:t.QUOTATION_MARK,[t.REVERSE_SOLIDUS]:t.REVERSE_SOLIDUS,[t.SOLIDUS]:t.SOLIDUS,[t.LATIN_SMALL_LETTER_B]:t.BACKSPACE,[t.LATIN_SMALL_LETTER_F]:t.FORM_FEED,[t.LATIN_SMALL_LETTER_N]:t.NEWLINE,[t.LATIN_SMALL_LETTER_R]:t.CARRIAGE_RETURN,[t.LATIN_SMALL_LETTER_T]:t.TAB};class T{constructor(){this.decoder=new TextDecoder("utf-8"),this.string="",this.byteLength=0}appendChar(t){this.string+=String.fromCharCode(t),this.byteLength+=1}appendBuf(t,e=0,s=t.length){this.string+=this.decoder.decode(t.subarray(e,s)),this.byteLength+=s-e}reset(){this.string="",this.byteLength=0}toString(){return this.string}}class E{constructor(t){this.decoder=new TextDecoder("utf-8"),this.bufferOffset=0,this.string="",this.byteLength=0,this.buffer=new Uint8Array(t)}appendChar(t){this.bufferOffset>=this.buffer.length&&this.flushStringBuffer(),this.buffer[this.bufferOffset++]=t,this.byteLength+=1}appendBuf(t,e=0,s=t.length){const i=s-e;this.bufferOffset+i>this.buffer.length&&this.flushStringBuffer(),this.buffer.set(t.subarray(e,s),this.bufferOffset),this.bufferOffset+=i,this.byteLength+=i}flushStringBuffer(){this.string+=this.decoder.decode(this.buffer.subarray(0,this.bufferOffset)),this.bufferOffset=0}reset(){this.string="",this.bufferOffset=0,this.byteLength=0}toString(){return this.flushStringBuffer(),this.string}}var _;!function(t){t[t.LEFT_BRACE=0]="LEFT_BRACE",t[t.RIGHT_BRACE=1]="RIGHT_BRACE",t[t.LEFT_BRACKET=2]="LEFT_BRACKET",t[t.RIGHT_BRACKET=3]="RIGHT_BRACKET",t[t.COLON=4]="COLON",t[t.COMMA=5]="COMMA",t[t.TRUE=6]="TRUE",t[t.FALSE=7]="FALSE",t[t.NULL=8]="NULL",t[t.STRING=9]="STRING",t[t.NUMBER=10]="NUMBER",t[t.SEPARATOR=11]="SEPARATOR"}(_||(_={}));const r=_;var n;function L(t){return["START","ENDED","ERROR","TRUE1","TRUE2","TRUE3","FALSE1","FALSE2","FALSE3","FALSE4","NULL1","NULL2","NULL3","STRING_DEFAULT","STRING_AFTER_BACKSLASH","STRING_UNICODE_DIGIT_1","STRING_UNICODE_DIGIT_2","STRING_UNICODE_DIGIT_3","STRING_UNICODE_DIGIT_4","STRING_INCOMPLETE_CHAR","NUMBER_AFTER_INITIAL_MINUS","NUMBER_AFTER_INITIAL_ZERO","NUMBER_AFTER_INITIAL_NON_ZERO","NUMBER_AFTER_FULL_STOP","NUMBER_AFTER_DECIMAL","NUMBER_AFTER_E","NUMBER_AFTER_E_AND_SIGN","NUMBER_AFTER_E_AND_DIGIT","SEPARATOR"][t]}!function(t){t[t.START=0]="START",t[t.ENDED=1]="ENDED",t[t.ERROR=2]="ERROR",t[t.TRUE1=3]="TRUE1",t[t.TRUE2=4]="TRUE2",t[t.TRUE3=5]="TRUE3",t[t.FALSE1=6]="FALSE1",t[t.FALSE2=7]="FALSE2",t[t.FALSE3=8]="FALSE3",t[t.FALSE4=9]="FALSE4",t[t.NULL1=10]="NULL1",t[t.NULL2=11]="NULL2",t[t.NULL3=12]="NULL3",t[t.STRING_DEFAULT=13]="STRING_DEFAULT",t[t.STRING_AFTER_BACKSLASH=14]="STRING_AFTER_BACKSLASH",t[t.STRING_UNICODE_DIGIT_1=15]="STRING_UNICODE_DIGIT_1",t[t.STRING_UNICODE_DIGIT_2=16]="STRING_UNICODE_DIGIT_2",t[t.STRING_UNICODE_DIGIT_3=17]="STRING_UNICODE_DIGIT_3",t[t.STRING_UNICODE_DIGIT_4=18]="STRING_UNICODE_DIGIT_4",t[t.STRING_INCOMPLETE_CHAR=19]="STRING_INCOMPLETE_CHAR",t[t.NUMBER_AFTER_INITIAL_MINUS=20]="NUMBER_AFTER_INITIAL_MINUS",t[t.NUMBER_AFTER_INITIAL_ZERO=21]="NUMBER_AFTER_INITIAL_ZERO",t[t.NUMBER_AFTER_INITIAL_NON_ZERO=22]="NUMBER_AFTER_INITIAL_NON_ZERO",t[t.NUMBER_AFTER_FULL_STOP=23]="NUMBER_AFTER_FULL_STOP",t[t.NUMBER_AFTER_DECIMAL=24]="NUMBER_AFTER_DECIMAL",t[t.NUMBER_AFTER_E=25]="NUMBER_AFTER_E",t[t.NUMBER_AFTER_E_AND_SIGN=26]="NUMBER_AFTER_E_AND_SIGN",t[t.NUMBER_AFTER_E_AND_DIGIT=27]="NUMBER_AFTER_E_AND_DIGIT",t[t.SEPARATOR=28]="SEPARATOR"}(n||(n={}));const A={stringBufferSize:0,numberBufferSize:0,separator:void 0};class a extends Error{constructor(t){super(t),Object.setPrototypeOf(this,a.prototype)}}class o{constructor(t){this.state=n.START,this.separatorIndex=0,this.bytes_remaining=0,this.bytes_in_sequence=0,this.char_split_buffer=new Uint8Array(4),this.encoder=new TextEncoder,this.offset=-1,t=Object.assign(Object.assign({},A),t),this.bufferedString=t.stringBufferSize&&t.stringBufferSize>4?new E(t.stringBufferSize):new T,this.bufferedNumber=t.numberBufferSize&&t.numberBufferSize>0?new E(t.numberBufferSize):new T,this.separator=t.separator,this.separatorBytes=t.separator?this.encoder.encode(t.separator):void 0}get isEnded(){return this.state===n.ENDED}write(e){try{let s;if(e instanceof Uint8Array)s=e;else if("string"==typeof e)s=this.encoder.encode(e);else{if(!("object"==typeof e&&"buffer"in e||Array.isArray(e)))throw new TypeError("Unexpected type. The `write` function only accepts Arrays, TypedArrays and Strings.");s=Uint8Array.from(e)}for(let e=0;e<s.length;e+=1){const T=s[e];switch(this.state){case n.START:if(this.offset+=1,this.separatorBytes&&T===this.separatorBytes[0]){if(1===this.separatorBytes.length){this.state=n.START,this.onToken({token:r.SEPARATOR,value:this.separator,offset:this.offset+this.separatorBytes.length-1});continue}this.state=n.SEPARATOR;continue}if(T===t.SPACE||T===t.NEWLINE||T===t.CARRIAGE_RETURN||T===t.TAB)continue;if(T===t.LEFT_CURLY_BRACKET){this.onToken({token:r.LEFT_BRACE,value:"{",offset:this.offset});continue}if(T===t.RIGHT_CURLY_BRACKET){this.onToken({token:r.RIGHT_BRACE,value:"}",offset:this.offset});continue}if(T===t.LEFT_SQUARE_BRACKET){this.onToken({token:r.LEFT_BRACKET,value:"[",offset:this.offset});continue}if(T===t.RIGHT_SQUARE_BRACKET){this.onToken({token:r.RIGHT_BRACKET,value:"]",offset:this.offset});continue}if(T===t.COLON){this.onToken({token:r.COLON,value:":",offset:this.offset});continue}if(T===t.COMMA){this.onToken({token:r.COMMA,value:",",offset:this.offset});continue}if(T===t.LATIN_SMALL_LETTER_T){this.state=n.TRUE1;continue}if(T===t.LATIN_SMALL_LETTER_F){this.state=n.FALSE1;continue}if(T===t.LATIN_SMALL_LETTER_N){this.state=n.NULL1;continue}if(T===t.QUOTATION_MARK){this.bufferedString.reset(),this.state=n.STRING_DEFAULT;continue}if(T>=t.DIGIT_ONE&&T<=t.DIGIT_NINE){this.bufferedNumber.reset(),this.bufferedNumber.appendChar(T),this.state=n.NUMBER_AFTER_INITIAL_NON_ZERO;continue}if(T===t.DIGIT_ZERO){this.bufferedNumber.reset(),this.bufferedNumber.appendChar(T),this.state=n.NUMBER_AFTER_INITIAL_ZERO;continue}if(T===t.HYPHEN_MINUS){this.bufferedNumber.reset(),this.bufferedNumber.appendChar(T),this.state=n.NUMBER_AFTER_INITIAL_MINUS;continue}break;case n.STRING_DEFAULT:if(T===t.QUOTATION_MARK){const t=this.bufferedString.toString();this.state=n.START,this.onToken({token:r.STRING,value:t,offset:this.offset}),this.offset+=this.bufferedString.byteLength+1;continue}if(T===t.REVERSE_SOLIDUS){this.state=n.STRING_AFTER_BACKSLASH;continue}if(T>=128){if(this.bytes_in_sequence=T>=194&&T<=223?2:T<=239?3:4,this.bytes_in_sequence<=s.length-e){this.bufferedString.appendBuf(s,e,e+this.bytes_in_sequence),e+=this.bytes_in_sequence-1;continue}this.bytes_remaining=e+this.bytes_in_sequence-s.length,this.char_split_buffer.set(s.subarray(e)),e=s.length-1,this.state=n.STRING_INCOMPLETE_CHAR;continue}if(T>=t.SPACE){this.bufferedString.appendChar(T);continue}break;case n.STRING_INCOMPLETE_CHAR:this.char_split_buffer.set(s.subarray(e,e+this.bytes_remaining),this.bytes_in_sequence-this.bytes_remaining),this.bufferedString.appendBuf(this.char_split_buffer,0,this.bytes_in_sequence),e=this.bytes_remaining-1,this.state=n.STRING_DEFAULT;continue;case n.STRING_AFTER_BACKSLASH:const E=i[T];if(E){this.bufferedString.appendChar(E),this.state=n.STRING_DEFAULT;continue}if(T===t.LATIN_SMALL_LETTER_U){this.unicode="",this.state=n.STRING_UNICODE_DIGIT_1;continue}break;case n.STRING_UNICODE_DIGIT_1:case n.STRING_UNICODE_DIGIT_2:case n.STRING_UNICODE_DIGIT_3:if(T>=t.DIGIT_ZERO&&T<=t.DIGIT_NINE||T>=t.LATIN_CAPITAL_LETTER_A&&T<=t.LATIN_CAPITAL_LETTER_F||T>=t.LATIN_SMALL_LETTER_A&&T<=t.LATIN_SMALL_LETTER_F){this.unicode+=String.fromCharCode(T),this.state+=1;continue}break;case n.STRING_UNICODE_DIGIT_4:if(T>=t.DIGIT_ZERO&&T<=t.DIGIT_NINE||T>=t.LATIN_CAPITAL_LETTER_A&&T<=t.LATIN_CAPITAL_LETTER_F||T>=t.LATIN_SMALL_LETTER_A&&T<=t.LATIN_SMALL_LETTER_F){const t=parseInt(this.unicode+String.fromCharCode(T),16);void 0===this.highSurrogate?t>=55296&&t<=56319?this.highSurrogate=t:this.bufferedString.appendBuf(this.encoder.encode(String.fromCharCode(t))):(t>=56320&&t<=57343?this.bufferedString.appendBuf(this.encoder.encode(String.fromCharCode(this.highSurrogate,t))):this.bufferedString.appendBuf(this.encoder.encode(String.fromCharCode(this.highSurrogate))),this.highSurrogate=void 0),this.state=n.STRING_DEFAULT;continue}break;case n.NUMBER_AFTER_INITIAL_MINUS:if(T===t.DIGIT_ZERO){this.bufferedNumber.appendChar(T),this.state=n.NUMBER_AFTER_INITIAL_ZERO;continue}if(T>=t.DIGIT_ONE&&T<=t.DIGIT_NINE){this.bufferedNumber.appendChar(T),this.state=n.NUMBER_AFTER_INITIAL_NON_ZERO;continue}break;case n.NUMBER_AFTER_INITIAL_ZERO:if(T===t.FULL_STOP){this.bufferedNumber.appendChar(T),this.state=n.NUMBER_AFTER_FULL_STOP;continue}if(T===t.LATIN_SMALL_LETTER_E||T===t.LATIN_CAPITAL_LETTER_E){this.bufferedNumber.appendChar(T),this.state=n.NUMBER_AFTER_E;continue}e-=1,this.state=n.START,this.emitNumber();continue;case n.NUMBER_AFTER_INITIAL_NON_ZERO:if(T>=t.DIGIT_ZERO&&T<=t.DIGIT_NINE){this.bufferedNumber.appendChar(T);continue}if(T===t.FULL_STOP){this.bufferedNumber.appendChar(T),this.state=n.NUMBER_AFTER_FULL_STOP;continue}if(T===t.LATIN_SMALL_LETTER_E||T===t.LATIN_CAPITAL_LETTER_E){this.bufferedNumber.appendChar(T),this.state=n.NUMBER_AFTER_E;continue}e-=1,this.state=n.START,this.emitNumber();continue;case n.NUMBER_AFTER_FULL_STOP:if(T>=t.DIGIT_ZERO&&T<=t.DIGIT_NINE){this.bufferedNumber.appendChar(T),this.state=n.NUMBER_AFTER_DECIMAL;continue}break;case n.NUMBER_AFTER_DECIMAL:if(T>=t.DIGIT_ZERO&&T<=t.DIGIT_NINE){this.bufferedNumber.appendChar(T);continue}if(T===t.LATIN_SMALL_LETTER_E||T===t.LATIN_CAPITAL_LETTER_E){this.bufferedNumber.appendChar(T),this.state=n.NUMBER_AFTER_E;continue}e-=1,this.state=n.START,this.emitNumber();continue;case n.NUMBER_AFTER_E:if(T===t.PLUS_SIGN||T===t.HYPHEN_MINUS){this.bufferedNumber.appendChar(T),this.state=n.NUMBER_AFTER_E_AND_SIGN;continue}case n.NUMBER_AFTER_E_AND_SIGN:if(T>=t.DIGIT_ZERO&&T<=t.DIGIT_NINE){this.bufferedNumber.appendChar(T),this.state=n.NUMBER_AFTER_E_AND_DIGIT;continue}break;case n.NUMBER_AFTER_E_AND_DIGIT:if(T>=t.DIGIT_ZERO&&T<=t.DIGIT_NINE){this.bufferedNumber.appendChar(T);continue}e-=1,this.state=n.START,this.emitNumber();continue;case n.TRUE1:if(T===t.LATIN_SMALL_LETTER_R){this.state=n.TRUE2;continue}break;case n.TRUE2:if(T===t.LATIN_SMALL_LETTER_U){this.state=n.TRUE3;continue}break;case n.TRUE3:if(T===t.LATIN_SMALL_LETTER_E){this.state=n.START,this.onToken({token:r.TRUE,value:!0,offset:this.offset}),this.offset+=3;continue}break;case n.FALSE1:if(T===t.LATIN_SMALL_LETTER_A){this.state=n.FALSE2;continue}break;case n.FALSE2:if(T===t.LATIN_SMALL_LETTER_L){this.state=n.FALSE3;continue}break;case n.FALSE3:if(T===t.LATIN_SMALL_LETTER_S){this.state=n.FALSE4;continue}break;case n.FALSE4:if(T===t.LATIN_SMALL_LETTER_E){this.state=n.START,this.onToken({token:r.FALSE,value:!1,offset:this.offset}),this.offset+=4;continue}break;case n.NULL1:if(T===t.LATIN_SMALL_LETTER_U){this.state=n.NULL2;continue}break;case n.NULL2:if(T===t.LATIN_SMALL_LETTER_L){this.state=n.NULL3;continue}break;case n.NULL3:if(T===t.LATIN_SMALL_LETTER_L){this.state=n.START,this.onToken({token:r.NULL,value:null,offset:this.offset}),this.offset+=3;continue}break;case n.SEPARATOR:if(this.separatorIndex+=1,!this.separatorBytes||T!==this.separatorBytes[this.separatorIndex])break;this.separatorIndex===this.separatorBytes.length-1&&(this.state=n.START,this.onToken({token:r.SEPARATOR,value:this.separator,offset:this.offset+this.separatorIndex}),this.separatorIndex=0);continue;case n.ENDED:if(T===t.SPACE||T===t.NEWLINE||T===t.CARRIAGE_RETURN||T===t.TAB)continue}throw new a(`Unexpected "${String.fromCharCode(T)}" at position "${e}" in state ${L(this.state)}`)}}catch(t){this.error(t)}}emitNumber(){this.onToken({token:r.NUMBER,value:this.parseNumber(this.bufferedNumber.toString()),offset:this.offset}),this.offset+=this.bufferedNumber.byteLength-1}parseNumber(t){return Number(t)}error(t){this.state!==n.ENDED&&(this.state=n.ERROR),this.onError(t)}end(){switch(this.state){case n.NUMBER_AFTER_INITIAL_ZERO:case n.NUMBER_AFTER_INITIAL_NON_ZERO:case n.NUMBER_AFTER_DECIMAL:case n.NUMBER_AFTER_E_AND_DIGIT:this.state=n.ENDED,this.emitNumber(),this.onEnd();break;case n.START:case n.ERROR:case n.SEPARATOR:this.state=n.ENDED,this.onEnd();break;default:this.error(new a(`Tokenizer ended in the middle of a token (state: ${L(this.state)}). Either not all the data was received or the data was invalid.`))}}onToken(t){throw new a('Can\'t emit tokens before the "onToken" callback has been set up.')}onError(t){throw t}onEnd(){}}var h,I;function R(t){return["VALUE","KEY","COLON","COMMA","ENDED","ERROR","SEPARATOR"][t]}!function(t){t[t.OBJECT=0]="OBJECT",t[t.ARRAY=1]="ARRAY"}(h||(h={})),function(t){t[t.VALUE=0]="VALUE",t[t.KEY=1]="KEY",t[t.COLON=2]="COLON",t[t.COMMA=3]="COMMA",t[t.ENDED=4]="ENDED",t[t.ERROR=5]="ERROR",t[t.SEPARATOR=6]="SEPARATOR"}(I||(I={}));const N={paths:void 0,keepStack:!0,separator:void 0};class u extends Error{constructor(t){super(t),Object.setPrototypeOf(this,u.prototype)}}class S{constructor(t){this.state=I.VALUE,this.mode=void 0,this.key=void 0,this.value=void 0,this.stack=[],(t=Object.assign(Object.assign({},N),t)).paths&&(this.paths=t.paths.map((t=>{if(void 0===t||"$*"===t)return;if(!t.startsWith("$"))throw new u(`Invalid selector "${t}". Should start with "$".`);const e=t.split(".").slice(1);if(e.includes(""))throw new u(`Invalid selector "${t}". ".." syntax not supported.`);return e}))),this.keepStack=t.keepStack||!1,this.separator=t.separator}shouldEmit(){return!this.paths||this.paths.some((t=>{var e;if(void 0===t)return!0;if(t.length!==this.stack.length)return!1;for(let e=0;e<t.length-1;e++){const s=t[e],i=this.stack[e+1].key;if("*"!==s&&s!==i)return!1}const s=t[t.length-1];return"*"===s||s===(null===(e=this.key)||void 0===e?void 0:e.toString())}))}push(){this.stack.push({key:this.key,value:this.value,mode:this.mode,emit:this.shouldEmit()})}pop(){const t=this.value;let e;({key:this.key,value:this.value,mode:this.mode,emit:e}=this.stack.pop()),this.state=void 0!==this.mode?I.COMMA:I.VALUE,this.emit(t,e)}emit(t,e){!this.keepStack&&this.value&&this.stack.every((t=>!t.emit))&&delete this.value[this.key],e&&this.onValue({value:t,key:this.key,parent:this.value,stack:this.stack}),0===this.stack.length&&(this.separator?this.state=I.SEPARATOR:void 0===this.separator&&this.end())}get isEnded(){return this.state===I.ENDED}write({token:t,value:e}){try{if(this.state===I.VALUE){if(t===r.STRING||t===r.NUMBER||t===r.TRUE||t===r.FALSE||t===r.NULL)return this.mode===h.OBJECT?(this.value[this.key]=e,this.state=I.COMMA):this.mode===h.ARRAY&&(this.value.push(e),this.state=I.COMMA),void this.emit(e,this.shouldEmit());if(t===r.LEFT_BRACE){if(this.push(),this.mode===h.OBJECT)this.value=this.value[this.key]={};else if(this.mode===h.ARRAY){const t={};this.value.push(t),this.value=t}else this.value={};return this.mode=h.OBJECT,this.state=I.KEY,void(this.key=void 0)}if(t===r.LEFT_BRACKET){if(this.push(),this.mode===h.OBJECT)this.value=this.value[this.key]=[];else if(this.mode===h.ARRAY){const t=[];this.value.push(t),this.value=t}else this.value=[];return this.mode=h.ARRAY,this.state=I.VALUE,void(this.key=0)}if(this.mode===h.ARRAY&&t===r.RIGHT_BRACKET&&0===this.value.length)return void this.pop()}if(this.state===I.KEY){if(t===r.STRING)return this.key=e,void(this.state=I.COLON);if(t===r.RIGHT_BRACE&&0===Object.keys(this.value).length)return void this.pop()}if(this.state===I.COLON&&t===r.COLON)return void(this.state=I.VALUE);if(this.state===I.COMMA){if(t===r.COMMA){if(this.mode===h.ARRAY)return this.state=I.VALUE,void(this.key+=1);if(this.mode===h.OBJECT)return void(this.state=I.KEY)}if(t===r.RIGHT_BRACE&&this.mode===h.OBJECT||t===r.RIGHT_BRACKET&&this.mode===h.ARRAY)return void this.pop()}if(this.state===I.SEPARATOR&&t===r.SEPARATOR&&e===this.separator)return void(this.state=I.VALUE);throw new u(`Unexpected ${r[t]} (${JSON.stringify(e)}) in state ${R(this.state)}`)}catch(t){this.error(t)}}error(t){this.state!==I.ENDED&&(this.state=I.ERROR),this.onError(t)}end(){this.state!==I.VALUE&&this.state!==I.SEPARATOR||this.stack.length>0?this.error(new Error(`Parser ended in mid-parsing (state: ${R(this.state)}). Either not all the data was received or the data was invalid.`)):(this.state=I.ENDED,this.onEnd())}onValue(t){throw new u('Can\'t emit data before the "onValue" callback has been set up.')}onError(t){throw t}onEnd(){}}class f{constructor(t={}){this.tokenizer=new o(t),this.tokenParser=new S(t),this.tokenizer.onToken=this.tokenParser.write.bind(this.tokenParser),this.tokenizer.onEnd=()=>{this.tokenParser.isEnded||this.tokenParser.end()},this.tokenParser.onError=this.tokenizer.error.bind(this.tokenizer),this.tokenParser.onEnd=()=>{this.tokenizer.isEnded||this.tokenizer.end()}}get isEnded(){return this.tokenizer.isEnded&&this.tokenParser.isEnded}write(t){this.tokenizer.write(t)}end(){this.tokenizer.end()}set onToken(t){this.tokenizer.onToken=t}set onValue(t){this.tokenParser.onValue=t}set onError(t){this.tokenizer.onError=t}set onEnd(t){this.tokenParser.onEnd=()=>{this.tokenizer.isEnded||this.tokenizer.end(),t.call(this.tokenParser)}}}class d{constructor(){this.getJSON,this.name,this.descriptions,this.dimensions,this.annotations,this.observations,this.attributes}parseSeries(t){let e={};const s=new f({paths:["$.data.dataSets.*.series.*"]});return s.onValue=function(t,s,i,T){Object.keys(t.value.observations).forEach(((s,i)=>{e[`${t.key}:${s}`]=t.value.observations[s]}))},s.write(t),e}async getDatasets(t,e={}){try{t.includes("format=jsondata")||(t=`${t}&format=jsondata`);const s=await fetch(t,e);if(200!==s.status)throw new Error("Error while fetching data please provide valid api url");const i=await s.text(),T=this.parseSeries(i);this.getJSON=JSON.parse(i),Object.keys(T).length>0&&(this.getJSON.data.dataSets[0].observations=T,delete this.getJSON.data.dataSets[0].series)}catch(t){throw new Error(t)}return this.getJSON}getName(){if(!(this.getJSON&&this.getJSON.data&&this.getJSON.data.structures[0]&&this.getJSON.data.structures[0].names))throw new Error("Name not found");return this.name=this.getJSON.data.structures[0].names.en,this.name}getDescription(){if(!(this.getJSON&&this.getJSON.data&&this.getJSON.data.structures[0]&&this.getJSON.data.structures[0].descriptions))throw new Error("Description not found");return this.descriptions=this.getJSON.data.structures[0].descriptions.en,this.descriptions}getAttributes(){if(!(this.getJSON&&this.getJSON.data&&this.getJSON.data.structures[0]&&this.getJSON.data.structures[0].attributes))throw new Error("Attributes not found");return this.attributes=this.getJSON.data.structures[0].attributes.observation,this.attributes}getRawDimensions(){if(!(this.getJSON&&this.getJSON.data&&this.getJSON.data.structures[0]&&this.getJSON.data.structures[0].dimensions))throw new Error("Dimensions not found");return this.getJSON.data.structures[0].dimensions.series.length>0?(this.dimensions=this.getJSON.data.structures[0].dimensions.series,this.getJSON.data.structures[0].dimensions.observation.length>0&&(this.dimensions=this.dimensions.concat(this.getJSON.data.structures[0].dimensions.observation))):this.dimensions=this.getJSON.data.structures[0].dimensions.observation,this.dimensions}getDimensions(t){if(t){const e=this.getRawDimensions().filter(((e,s)=>e.id===t));if(!e.length)throw new Error("Dimension not found");return e}const[e,s]=[this.getRawDimensions(),this.getObservations()];let i=[];return Object.keys(s).forEach(((t,e)=>{t.split(":").map(((t,e)=>{if(t>0){if(i.includes(e))return;i.push(e)}}))})),i.map(((t,s)=>e.find(((e,s)=>e.keyPosition===t))))}getObservations(){if(this.getJSON&&this.getJSON.data&&this.getJSON.data.dataSets)if(this.getJSON.data.dataSets[0].series){this.observations={};const t=this.getJSON.data.dataSets[0].series;Object.keys(t).forEach(((e,s)=>{const i=t[e];Object.keys(i.observations).forEach(((t,s)=>{this.observations[`${e}:${t}`]=i.observations[t]}))}))}else{if(!this.getJSON.data.dataSets[0].observations)throw new Error("Series not found and observations empty");this.observations=this.getJSON.data.dataSets[0].observations}return this.observations}getAnnotations(){if(!(this.getJSON&&this.getJSON.data&&this.getJSON.data.structures[0]&&this.getJSON.data.structures[0].annotations))throw new Error("Annotations not found");return this.annotations=this.getJSON.data.structures[0].annotations,this.annotations}slice(t){const e=this.getObservations(),s=this.getRawDimensions(),i=this.getAttributes();let T=[],E=[],_=0;const r=[],n=s.map((t=>t.id));Object.keys(t).forEach((t=>{if(!n.includes(t))throw new Error(`provided key ${t} is not valid dimension`)})),s.map(((e,s)=>{Object.keys(t).includes(e.id)&&T.push({name:e.id,keyPosition:e.keyPosition,value:e.values,index:[]})})),T.map(((e,s)=>{e.value.map(((s,i)=>{t[e.name].includes(s.id)&&e.index.push(i)})),delete e.value})),Object.keys(e).map(((t,e)=>{const s=t.split(":");T.forEach(((t,e)=>{t.index.includes(Number(s[t.keyPosition]))&&(t.sdmxKeys?t.sdmxKeys.push(s):t.sdmxKeys=[s])}))})),T.forEach((t=>{r.push(...t.sdmxKeys)}));let L=i.length;return r.forEach(((t,T)=>{let r=t.join(":");E.push({dimensions:{sdmxKeys:t},measure:e[r][0],attributes:{}});for(let t=0;t<L;t++)E[T].attributes[i[t].id]=i[t].values[e[r][t+1]]?{id:i[t].values[e[r][t+1]].id,name:i[t].values[e[r][t+1]].name}:null;t.forEach(((t,e)=>{E[_].dimensions[s[e].id]={id:s[e].values[t].id,name:s[e].values[t].name}})),_++})),E}getData(){if(!this.getJSON)throw new Error("Please load the api first");const t=this.getObservations(),e=this.getDimensions();let s=[];for(let i in t){const T=i.split(":");let E={};T.forEach(((s,_)=>{e.find(((e,s)=>{e.keyPosition===_&&(E[e.id]=e.values[T[_]].name,E.value=t[i][0])}))})),s.push(E)}return s}}return s})()));